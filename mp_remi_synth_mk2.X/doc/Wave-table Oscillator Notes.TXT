
 Wave-table Oscillator Notes:
 ````````````````````````````
 The Wave-table Oscillator algorithm works by fetching samples from a wave-table at a sample
 rate of 40 kHz, i.e. one sample output every 25us.  The frequency of the output wave is
 determined by the "distance" (phase angle) between points taken from the wave-table.
 The shorter the distance (angle), the lower the output frequency. When the table index of
 the next sample to be taken goes beyond the end of the table, the index is adjusted so that
 it wraps around to a point within the table, maintaining the correct sample "distance".
 Let's call the distance between sample points the "Phase Angle Step".

 In practice, to obtain the required accuracy of pitch for musical purposes, the Phase Angle
 Step needs to be a real number, i.e. with an integer and fractional part. Floating-point
 arithmetic would make the job easy, but it is too slow for use in a real-time synthesizer
 using a micro-controller without a floating-point co-processor (e.g. Microchip PIC32MX),
 so 32-bit fixed-point arithmetic is used. The high-order 18 bits represent the integer part
 and the low-order 14 bits the fractional part of the accumulated Phase Angle (sample point).
 The integer part of this quantity is used as the table index to fetch a sample point.
 Interpolation between points is not necessary -- the resulting waveform distortion is
 imperceptable.

 The frequencies of musical notes (semitones on the chromatic scale) are related to the
 distance between notes by an exponential function, i.e. the frequency doubles for every
 octave higher up the scale. This transformation is too slow to perform in real time using
 using real numbers, so a look-up table (LUT) is used. The LUT has one entry for every note
 (semitone) over a 4-octave range. The frequencies of notes in lower octaves is obtained
 by dividing by a power of two.

 The Phase Angle Step for a given note is calculated from the note-frequency look-up table.
 This variable can be further manipulated in real-time to modulate the oscillator frequency,
 e.g. to implement "pitch bend" or "vibrato" effects.

 The formula relating Phase Angle Step to Oscillator Frequency is:

         PhaseStep = (OscFreq / FreqDiv) x (TableSize / SampleRate)

 where:  PhaseStep is the distance between sample points in the wave-table (real number),
         OscFreq is the required output frequency (Hz, real number),
         FreqDiv is (typically) the order of the dominant partial (1, 2, 3, ...),
         TableSize is total number of samples in the wave-table,
         SampleRate is the sampling rate (Hz, typically 40,000).

 The formula assumes that the wave-table spans one full cycle at the "fundamental"
 frequency (1st-order partial), whether or not it is present in the waveform.
  

 Although wave-tables may be any size up to 8000 samples, standard sizes of 1008 and 2520 are
 recommended. These sizes yield perfect harmonic ratios for most low-order harmonics, where
 additive synthesis (addition of sine-waves) is used to create waveforms.

 The fundamental frequency (dominant pitch) of a waveform is not restricted to fill the whole
 wave-table with a single cycle. The Dominant Pitch is defined simply by the "partial"
 (frequency) with the greatest amplitude. REMI's synth patch (data structure) provides a
 parameter called the "Frequency Divider" which allows the Dominant Pitch of the composite
 waveform to be adjusted to coincide with standard "concert pitch".

 For example, if the Dominant Pitch of the waveform is produced by a single cycle filling the
 whole wave-table and the Frequency Divider value is set to 1.0, the wave-table oscillator
 would produce a frequency of 440Hz when the note 'A4' (A above middle-C) is played.
 But if the Dominant Pitch of the waveform is produced by five cycles filling the wave-table
 and the Freq Divider is set to 1.0, the synth would produce a frequency five times higher,
 i.e. 5 x 440Hz when note A4 is played. To adjust the pitch back to the standard A-440Hz,
 the Freq Divider value must be set to 5. The active Freq Divider value is set whenever 
 the instrument patch is changed, i.e. whenever a Preset is selected.

 The Freq Divider parameter allows wave-tables to contain "partials" (frequencies) not
 restricted to "fundamental plus higher-order harmonics" as in simple periodic waveforms.
 For example, a wave-table could be constructed with two "partials", one comprising 5 cycles
 and the other 7 cycles. The dominant partial could be either of these.  To get the
 instrument to play "in tune", the Freq Divider must be set to either 5 or 7 accordingly.

 The Frequency Divider parameter is actually associated with the wave-table definition,
 not the patch definition, so different instrument patches can specify any wave-table
 without regard to the Freq Divider requirement.

 The Frequency Divider parameter is not intended to be used to transpose an instrument's
 tuning. An instrument Preset parameter is provided for this purpose, which affects not
 only the built-in synth tuning, but also the external MIDI synth tuning. The pitch
 transpose parameter has a unit (resolution) of one semitone.

